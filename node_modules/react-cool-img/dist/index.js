"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react");function r(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var t=r(e);function n(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function o(){return(o=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e}).apply(this,arguments)}var i="REACT_COOL_IMG",s=function(){function e(){n(this,"img",null),n(this,"timeout",null),n(this,"retries",1)}var r=e.prototype;return r.load=function(e,r,t,n,o,i){var s=this,c=t.count,u=void 0===c?3:c,l=t.delay,a=void 0===l?2:l,f=t.acc,d=void 0===f?"*":f;this.img=new Image,this.img.src=e,i&&(this.img.crossOrigin=i),r&&this.img.decode&&this.img.decode().catch((function(){})),this.img.onerror=function(r){if(!u||s.retries>u)n(r);else{var t="*"===d?Math.pow(a,s.retries):a*s.retries;t=!1===d?a:t,s.timeout=setTimeout((function(){s.clearImgSrc(),s.img.src=e}),1e3*t),s.retries+=1}},this.img.onload=function(e){return o(e)}},r.unload=function(){this.img&&(this.img.onerror=null,this.img.onload=null,this.clearImgSrc(),this.img=null),this.timeout&&(clearTimeout(this.timeout),this.timeout=null),this.retries=1},r.clearImgSrc=function(){this.img.src="";try{delete this.img.src}catch(e){}},e}(),c=function(r){var t=e.useRef(r);return t.current=r,t},u=["className","placeholder","src","error","crossOrigin","decode","lazy","cache","debounce","observerOptions","retry","srcSet","sizes","onError","onLoad"],l="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==",a=e.forwardRef((function(r,n){var a=r.className,f=void 0===a?"":a,d=r.placeholder,m=r.src,g=r.error,h=r.crossOrigin,v=r.decode,p=void 0===v||v,b=r.lazy,A=void 0===b||b,O=r.cache,y=void 0===O||O,w=r.debounce,S=void 0===w?300:w,I=r.observerOptions,E=void 0===I?{}:I,R=r.retry,j=void 0===R?{}:R,z=r.srcSet,N=r.sizes,C=r.onError,M=r.onLoad,T=function(e,r){if(null==e)return{};var t,n,o={},i=Object.keys(e);for(n=0;n<i.length;n++)t=i[n],r.indexOf(t)>=0||(o[t]=e[t]);return o}(r,u),x=function(r,t){var n=t.root,o=t.rootMargin,i=void 0===o?"50px":o,s=t.threshold,c=void 0===s?.01:s,u=e.useState(!1),l=u[0],a=u[1],f=e.useState(null),d=f[0],m=f[1],g=e.useRef(null),h=e.useRef(null),v=e.useRef(!1),p=c;"number"!=typeof c&&(console.warn("ðŸ’¡react-cool-img: the threshold of observerOptions must be a number. Use 0 as fallback."),p=0);var b=e.useCallback((function(){h.current&&(clearTimeout(h.current),h.current=null)}),[]);return e.useEffect((function(){if(!("IntersectionObserver"in window)||!("IntersectionObserverEntry"in window))return v.current||(console.error("ðŸ’¡react-cool-img: the browser doesn't support Intersection Observer, please install polyfill to enable lazy loading: https://github.com/wellyshen/react-cool-img#intersection-observer-polyfill"),v.current=!0),a(!0),function(){return null};g.current=new IntersectionObserver((function(e){var t=e[0],n=t.isIntersecting,o=t.intersectionRatio;(void 0!==n?n:o>0)&&!l?h.current=setTimeout((function(){a(!0)}),r):b()}),{root:n,rootMargin:i,threshold:p});var e=g.current;return d&&e.observe(d),function(){e.disconnect(),b()}}),[d,l,n,i,p,r,b]),[m,l]}(S,E),L=x[0],P=x[1],_=e.useState(d||l),k=_[0],B=_[1],J=e.useRef(new s),D=c(C),G=c(M),q=k===m,F=m?m.replace(/^.*[\\/]/,"").split(".")[0]:"";return e.useEffect((function(){if(!m)return B(d||l),function(){return null};var e=J.current;return(!A||y&&function(e){try{return!!JSON.parse(sessionStorage.getItem(i)||"{}")[e]}catch(e){return console.error("ðŸ’¡ react-cool-img: "+e),!1}}(m)||P)&&e.load(m,p,j,(function(e){B((function(e){return g||d||e})),D.current&&D.current(e)}),(function(e){B(m),y&&function(e){try{var r=JSON.parse(sessionStorage.getItem(i)||"{}");r[e]=new Date,sessionStorage.setItem(i,JSON.stringify(r))}catch(e){console.error("ðŸ’¡ react-cool-img: "+e)}}(m),G.current&&G.current(e)}),h),function(){return e.unload()}}),[y,h,p,g,A,D,G,d,m,P]),t.default.createElement(t.default.Fragment,null,t.default.createElement("img",o({className:f+" no-js-"+F,src:k,crossOrigin:q?h:void 0,srcSet:q?z:void 0,sizes:q?N:void 0},T,{ref:function(e){e&&(L(e),n&&(n.current=e))}})),t.default.createElement("noscript",null,t.default.createElement("style",null,".no-js-"+F+" { display: none !important; }"),t.default.createElement("img",o({className:f,src:m,crossOrigin:h,srcSet:z,sizes:N},T))))})),f=e.memo(a);exports.default=f;
